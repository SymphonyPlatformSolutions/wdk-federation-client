id: list-contacts
activities:
  - list-connect-contacts:
      id: listOne
      on:
        message-received:
          content: /find-contact {email}
      network: WHATSAPP
      email-address: ${event.args.email}

  - send-message:
      id: error
      on:
        activity-failed:
          activity-id: listOne
      content: Unable to find matching contact

  - execute-script:
      id: debug
      on:
        activity-completed:
          activity-id: listOne
      script: |
        import groovy.json.JsonOutput
        variables.report = JsonOutput.prettyPrint(JsonOutput.toJson(listOne.outputs.contacts)) 
        println variables.report

  - send-message:
      id: report
      content: <code>${escape(variables.report)}</code>
